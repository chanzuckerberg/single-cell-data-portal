{"levelname": "INFO", "asctime": "2022-12-12T21:12:18.012Z", "name": "dataset_processing", "message": "Uploading [9013ae0d-37a3-46ad-bd5d-0ce3235993bb/None] to S3 bucket: [test-artifact-bucket].", "lineno": 38, "pathname": "/single-cell-data-portal/backend/portal/pipeline/processing/common.py"}
{"levelname": "ERROR", "asctime": "2022-12-12T21:12:18.012Z", "name": "dataset_processing", "message": "expected str, bytes or os.PathLike object, not NoneType", "lineno": 57, "pathname": "/single-cell-data-portal/backend/portal/pipeline/processing/common.py"}
{"levelname": "INFO", "asctime": "2022-12-12T21:12:18.012Z", "name": "dataset_processing", "message": "Uploading [9013ae0d-37a3-46ad-bd5d-0ce3235993bb//tmp/tmp0ac49u4o/test.h5ad] to S3 bucket: [test-artifact-bucket].", "lineno": 38, "pathname": "/single-cell-data-portal/backend/portal/pipeline/processing/common.py"}
{"levelname": "INFO", "asctime": "2022-12-12T21:12:18.012Z", "name": "dataset_processing", "message": "Updating database with  BadEnum.fake.", "lineno": 42, "pathname": "/single-cell-data-portal/backend/portal/pipeline/processing/common.py"}
{"levelname": "ERROR", "asctime": "2022-12-12T21:12:18.012Z", "name": "backend.common.utils.db_session", "message": "(builtins.LookupError) 'BadEnum.fake' is not among the defined enum values. Enum name: datasetartifactfiletype. Possible values: H5AD, RDS, CXG\n[SQL: INSERT INTO dataset_artifact (id, created_at, updated_at, dataset_id, filename, filetype, user_submitted, s3_uri) VALUES (%(id)s, %(created_at)s, %(updated_at)s, %(dataset_id)s, %(filename)s, %(filetype)s, %(user_submitted)s, %(s3_uri)s)]\n[parameters: [{'user_submitted': True, 'filename': '/tmp/tmp0ac49u4o/test.h5ad', 'filetype': <BadEnum.fake: 'fake'>, 'dataset_id': '9013ae0d-37a3-46ad-bd5d-0ce3235993bb', 's3_uri': 's3://test-artifact-bucket/9013ae0d-37a3-46ad-bd5d-0ce3235993bb/test.h5ad'}]]", "lineno": 57, "pathname": "/single-cell-data-portal/backend/common/utils/db_session.py", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/sql/sqltypes.py\", line 1608, in _db_value_for_elem\n    return self._valid_lookup[elem]\nKeyError: <BadEnum.fake: 'fake'>\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/engine/base.py\", line 1800, in _execute_context\n    context = constructor(\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/engine/default.py\", line 1121, in _init_compiled\n    param = {\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/engine/default.py\", line 1122, in <dictcomp>\n    key: processors[key](compiled_params[key])\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/sql/sqltypes.py\", line 1756, in process\n    value = self._db_value_for_elem(value)\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/sql/sqltypes.py\", line 1623, in _db_value_for_elem\n    util.raise_(\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/util/compat.py\", line 211, in raise_\n    raise exception\nLookupError: 'BadEnum.fake' is not among the defined enum values. Enum name: datasetartifactfiletype. Possible values: H5AD, RDS, CXG\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/single-cell-data-portal/backend/common/utils/db_session.py\", line 51, in db_session_manager\n    yield session\n  File \"/single-cell-data-portal/backend/portal/pipeline/processing/common.py\", line 43, in create_artifact\n    DatasetAsset.create(\n  File \"/single-cell-data-portal/backend/common/entities/dataset_asset.py\", line 90, in create\n    session.commit()\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/orm/session.py\", line 1451, in commit\n    self._transaction.commit(_to_root=self.future)\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/orm/session.py\", line 829, in commit\n    self._prepare_impl()\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/orm/session.py\", line 808, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/orm/session.py\", line 3444, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/orm/session.py\", line 3583, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/util/langhelpers.py\", line 70, in __exit__\n    compat.raise_(\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/util/compat.py\", line 211, in raise_\n    raise exception\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/orm/session.py\", line 3544, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/orm/unitofwork.py\", line 456, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/orm/unitofwork.py\", line 630, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/orm/persistence.py\", line 245, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/orm/persistence.py\", line 1238, in _emit_insert_statements\n    result = connection._execute_20(\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/engine/base.py\", line 1705, in _execute_20\n    return meth(self, args_10style, kwargs_10style, execution_options)\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/sql/elements.py\", line 334, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/engine/base.py\", line 1572, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/engine/base.py\", line 1806, in _execute_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/engine/base.py\", line 2124, in _handle_dbapi_exception\n    util.raise_(\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/util/compat.py\", line 211, in raise_\n    raise exception\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/engine/base.py\", line 1800, in _execute_context\n    context = constructor(\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/engine/default.py\", line 1121, in _init_compiled\n    param = {\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/engine/default.py\", line 1122, in <dictcomp>\n    key: processors[key](compiled_params[key])\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/sql/sqltypes.py\", line 1756, in process\n    value = self._db_value_for_elem(value)\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/sql/sqltypes.py\", line 1623, in _db_value_for_elem\n    util.raise_(\n  File \"/usr/local/lib/python3.10/dist-packages/sqlalchemy/util/compat.py\", line 211, in raise_\n    raise exception\nsqlalchemy.exc.StatementError: (builtins.LookupError) 'BadEnum.fake' is not among the defined enum values. Enum name: datasetartifactfiletype. Possible values: H5AD, RDS, CXG\n[SQL: INSERT INTO dataset_artifact (id, created_at, updated_at, dataset_id, filename, filetype, user_submitted, s3_uri) VALUES (%(id)s, %(created_at)s, %(updated_at)s, %(dataset_id)s, %(filename)s, %(filetype)s, %(user_submitted)s, %(s3_uri)s)]\n[parameters: [{'user_submitted': True, 'filename': '/tmp/tmp0ac49u4o/test.h5ad', 'filetype': <BadEnum.fake: 'fake'>, 'dataset_id': '9013ae0d-37a3-46ad-bd5d-0ce3235993bb', 's3_uri': 's3://test-artifact-bucket/9013ae0d-37a3-46ad-bd5d-0ce3235993bb/test.h5ad'}]]"}
{"levelname": "ERROR", "asctime": "2022-12-12T21:12:18.012Z", "name": "dataset_processing", "message": "Failed to commit.", "lineno": 57, "pathname": "/single-cell-data-portal/backend/portal/pipeline/processing/common.py"}
{"levelname": "INFO", "asctime": "2022-12-12T21:12:18.012Z", "name": "dataset_processing", "message": "Uploading [9013ae0d-37a3-46ad-bd5d-0ce3235993bb//tmp/tmp0ac49u4o/test.h5ad] to S3 bucket: [fake-bucket].", "lineno": 38, "pathname": "/single-cell-data-portal/backend/portal/pipeline/processing/common.py"}
{"levelname": "ERROR", "asctime": "2022-12-12T21:12:18.012Z", "name": "dataset_processing", "message": "Failed to upload /tmp/tmp0ac49u4o/test.h5ad to fake-bucket/9013ae0d-37a3-46ad-bd5d-0ce3235993bb/test.h5ad: An error occurred (NoSuchBucket) when calling the PutObject operation: The specified bucket does not exist", "lineno": 57, "pathname": "/single-cell-data-portal/backend/portal/pipeline/processing/common.py"}
