{"uid":"8e3a9dad6a16c924","name":"test__rollup[no_compare_dim_all_tissues_have_all_cell_types-input_cell_counts_df0-expected_cell_counts_df0-input_gene_expr_df0-expected_gene_expr_df0]","fullName":"tests.unit.backend.wmg.api.common.test_rollup#test__rollup","historyId":"f8f8ae804e63395ddf252e5ce0694c9b","time":{"start":1745429628060,"stop":1745429628100,"duration":40},"description":"\n    Test that the `rollup` function correctly accumulates (or rolls up) gene-expression\n    values FOR EACH expressed gene and cell count values up the cell type ANCESTOR paths\n    grouped by (tissue_ontology_term_id, cell_type_ontology_term_id, <compare_dimension>).\n\n    The input:\n\n    1. A cell type ontology subgraph consisting of 4 cell types.\n\n    CL:0000127\n    ├── CL:0000644\n    ├── CL:0002605\n    └── CL:0002627\n\n    2. A gene expression dataframe consisting of expression numeric values for each\n    (gene_ontology_term_id, tissue_ontology_term_id, cell_type_ontology_term_id, <compare_dimension>) tuple.\n    3. The gene expression dataframe also holds total cell counts per tissue_ontology_term_id.\n    This value is held in a column called `n_cells_tissue`.\n    6. A cell counts dataframe that consists of cell counts for each\n    (tissue_ontology_term_id, cell_type_ontology_term_id, <compare_dimension>) tuple.\n    7. We set the `n_cells_tissue` column values to 1000 for all rows\n    in the gene expression dataframe.\n    8. We set all other numeric column values to `1` in the gene expression dataframe.\n\n    The expected output:\n\n    1. A rolled up gene expression dataframe.\n    2. A rolled up cell counts dataframe.\n    3. Assert that `n_cells_tissue` column value in the rolled up gene expression dataframe\n    does not change for all rows because it should not be rolled up the cell type ontology\n    ancestor paths.\n    4. Assert that other numeric column values (i.e the columns that are not `n_cells_tissue`)\n    in the rolled up gene expression dataframe hold the correct rolled up values.\n    5. Assert that the cell counts in the rolled up cell counts dataframe hold the correct\n    rolled up values.\n    ","descriptionHtml":"<pre><code>Test that the `rollup` function correctly accumulates (or rolls up) gene-expression\nvalues FOR EACH expressed gene and cell count values up the cell type ANCESTOR paths\ngrouped by (tissue_ontology_term_id, cell_type_ontology_term_id, &lt;compare_dimension&gt;).\n\nThe input:\n\n1. A cell type ontology subgraph consisting of 4 cell types.\n\nCL:0000127\n├── CL:0000644\n├── CL:0002605\n└── CL:0002627\n\n2. A gene expression dataframe consisting of expression numeric values for each\n(gene_ontology_term_id, tissue_ontology_term_id, cell_type_ontology_term_id, &lt;compare_dimension&gt;) tuple.\n3. The gene expression dataframe also holds total cell counts per tissue_ontology_term_id.\nThis value is held in a column called `n_cells_tissue`.\n6. A cell counts dataframe that consists of cell counts for each\n(tissue_ontology_term_id, cell_type_ontology_term_id, &lt;compare_dimension&gt;) tuple.\n7. We set the `n_cells_tissue` column values to 1000 for all rows\nin the gene expression dataframe.\n8. We set all other numeric column values to `1` in the gene expression dataframe.\n\nThe expected output:\n\n1. A rolled up gene expression dataframe.\n2. A rolled up cell counts dataframe.\n3. Assert that `n_cells_tissue` column value in the rolled up gene expression dataframe\ndoes not change for all rows because it should not be rolled up the cell type ontology\nancestor paths.\n4. Assert that other numeric column values (i.e the columns that are not `n_cells_tissue`)\nin the rolled up gene expression dataframe hold the correct rolled up values.\n5. Assert that the cell counts in the rolled up cell counts dataframe hold the correct\nrolled up values.\n</code></pre>\n","status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"patch_all","time":{"start":1745429625173,"stop":1745429625174,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"\n    Test that the `rollup` function correctly accumulates (or rolls up) gene-expression\n    values FOR EACH expressed gene and cell count values up the cell type ANCESTOR paths\n    grouped by (tissue_ontology_term_id, cell_type_ontology_term_id, <compare_dimension>).\n\n    The input:\n\n    1. A cell type ontology subgraph consisting of 4 cell types.\n\n    CL:0000127\n    ├── CL:0000644\n    ├── CL:0002605\n    └── CL:0002627\n\n    2. A gene expression dataframe consisting of expression numeric values for each\n    (gene_ontology_term_id, tissue_ontology_term_id, cell_type_ontology_term_id, <compare_dimension>) tuple.\n    3. The gene expression dataframe also holds total cell counts per tissue_ontology_term_id.\n    This value is held in a column called `n_cells_tissue`.\n    6. A cell counts dataframe that consists of cell counts for each\n    (tissue_ontology_term_id, cell_type_ontology_term_id, <compare_dimension>) tuple.\n    7. We set the `n_cells_tissue` column values to 1000 for all rows\n    in the gene expression dataframe.\n    8. We set all other numeric column values to `1` in the gene expression dataframe.\n\n    The expected output:\n\n    1. A rolled up gene expression dataframe.\n    2. A rolled up cell counts dataframe.\n    3. Assert that `n_cells_tissue` column value in the rolled up gene expression dataframe\n    does not change for all rows because it should not be rolled up the cell type ontology\n    ancestor paths.\n    4. Assert that other numeric column values (i.e the columns that are not `n_cells_tissue`)\n    in the rolled up gene expression dataframe hold the correct rolled up values.\n    5. Assert that the cell counts in the rolled up cell counts dataframe hold the correct\n    rolled up values.\n    ","status":"passed","steps":[],"attachments":[{"uid":"23f010f1f665718d","name":"log","source":"23f010f1f665718d.txt","type":"text/plain","size":230},{"uid":"d30be73f109fa03c","name":"stderr","source":"d30be73f109fa03c.txt","type":"text/plain","size":704}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":2,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"parentSuite","value":"tests.unit.backend.wmg.api.common"},{"name":"suite","value":"test_rollup"},{"name":"host","value":"730e3a615f61"},{"name":"thread","value":"1-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.unit.backend.wmg.api.common.test_rollup"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"expected_cell_counts_df","value":"                                                    n_cells_cell_type\ntissue_ontology_term_id cell_type_ontology_term_id                   \nUBERON:0000955          CL:0000127                                540\n                        CL:0000644                                 70\n                        CL:0002605                                 80\n                        CL:0002627                                 90\nUBERON:0002113          CL:0000127                                540\n                        CL:0000644                                 70\n                        CL:0002605                                 80\n                        CL:0002627                                 90"},{"name":"expected_gene_expr_df","value":"  gene_ontology_term_id  ... n_cells_tissue\n0       ENSG00000085265  ...           1000\n1       ENSG00000169429  ...           1000\n2       ENSG00000085265  ...           1000\n3       ENSG00000085265  ...           1000\n4       ENSG00000169429  ...           1000\n5       ENSG00000085265  ...           1000\n6       ENSG00000169429  ...           1000\n7       ENSG00000085265  ...           1000\n8       ENSG00000085265  ...           1000\n9       ENSG00000169429  ...           1000\n\n[10 rows x 7 columns]"},{"name":"input_cell_counts_df","value":"                                                    n_cells_cell_type\ntissue_ontology_term_id cell_type_ontology_term_id                   \nUBERON:0000955          CL:0000127                                300\n                        CL:0000644                                 70\n                        CL:0002605                                 80\n                        CL:0002627                                 90\nUBERON:0002113          CL:0000127                                300\n                        CL:0000644                                 70\n                        CL:0002605                                 80\n                        CL:0002627                                 90"},{"name":"input_gene_expr_df","value":"  gene_ontology_term_id  ... n_cells_tissue\n0       ENSG00000085265  ...           1000\n1       ENSG00000085265  ...           1000\n2       ENSG00000169429  ...           1000\n3       ENSG00000085265  ...           1000\n4       ENSG00000085265  ...           1000\n5       ENSG00000169429  ...           1000\n\n[6 rows x 7 columns]"},{"name":"name","value":"'no_compare_dim_all_tissues_have_all_cell_types'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[],"history":{"statistic":{"failed":0,"broken":0,"skipped":0,"passed":126,"unknown":0,"total":126},"items":[{"uid":"40e46f41e3fb2222","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24287//#testresult/40e46f41e3fb2222","status":"passed","time":{"start":1745427279638,"stop":1745427279676,"duration":38}},{"uid":"e24d0c81672a38df","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24286//#testresult/e24d0c81672a38df","status":"passed","time":{"start":1745427246334,"stop":1745427246372,"duration":38}},{"uid":"dd54d7a5812911be","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24285//#testresult/dd54d7a5812911be","status":"passed","time":{"start":1745423279062,"stop":1745423279172,"duration":110}},{"uid":"3d00db7c62ca0e24","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24284//#testresult/3d00db7c62ca0e24","status":"passed","time":{"start":1745418511206,"stop":1745418511309,"duration":103}},{"uid":"653d29b9d78296c0","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24283//#testresult/653d29b9d78296c0","status":"passed","time":{"start":1745416545207,"stop":1745416545313,"duration":106}},{"uid":"78ee7a64f5f43002","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24282//#testresult/78ee7a64f5f43002","status":"passed","time":{"start":1745416207608,"stop":1745416207721,"duration":113}},{"uid":"ef5de6f990b55ff","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24281//#testresult/ef5de6f990b55ff","status":"passed","time":{"start":1745414289916,"stop":1745414289953,"duration":37}},{"uid":"a57b6b1755dbd166","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24280//#testresult/a57b6b1755dbd166","status":"passed","time":{"start":1745412293160,"stop":1745412293199,"duration":39}},{"uid":"e7b44ffce95b32e2","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24279//#testresult/e7b44ffce95b32e2","status":"passed","time":{"start":1745409394675,"stop":1745409394788,"duration":113}},{"uid":"6059d09c291e1869","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24278//#testresult/6059d09c291e1869","status":"passed","time":{"start":1745381805039,"stop":1745381805076,"duration":37}},{"uid":"ece7c7b79854b6f1","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24277//#testresult/ece7c7b79854b6f1","status":"passed","time":{"start":1745380883015,"stop":1745380883120,"duration":105}},{"uid":"3ae2f2af8fc120bd","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24276//#testresult/3ae2f2af8fc120bd","status":"passed","time":{"start":1745377340790,"stop":1745377340910,"duration":120}},{"uid":"5cba0fc8952dad72","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24275//#testresult/5cba0fc8952dad72","status":"passed","time":{"start":1745353975324,"stop":1745353975439,"duration":115}},{"uid":"ed44aa3afa7f6466","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24274//#testresult/ed44aa3afa7f6466","status":"passed","time":{"start":1745345805207,"stop":1745345805246,"duration":39}},{"uid":"71457bd7667ef70f","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24273//#testresult/71457bd7667ef70f","status":"passed","time":{"start":1745340782916,"stop":1745340782955,"duration":39}},{"uid":"2f1398e6e796f09f","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24264//#testresult/2f1398e6e796f09f","status":"passed","time":{"start":1745336484917,"stop":1745336484955,"duration":38}},{"uid":"c07102faba30b347","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24263//#testresult/c07102faba30b347","status":"passed","time":{"start":1745333589948,"stop":1745333590048,"duration":100}},{"uid":"e4bb440674b03e4c","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24262//#testresult/e4bb440674b03e4c","status":"passed","time":{"start":1745332596360,"stop":1745332596399,"duration":39}},{"uid":"e024aee7050cef22","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24250//#testresult/e024aee7050cef22","status":"passed","time":{"start":1745257637562,"stop":1745257637599,"duration":37}},{"uid":"98e2bdd905de9320","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24249//#testresult/98e2bdd905de9320","status":"passed","time":{"start":1745243240338,"stop":1745243240375,"duration":37}}]},"tags":[]},"source":"8e3a9dad6a16c924.json","parameterValues":["                                                    n_cells_cell_type\ntissue_ontology_term_id cell_type_ontology_term_id                   \nUBERON:0000955          CL:0000127                                540\n                        CL:0000644                                 70\n                        CL:0002605                                 80\n                        CL:0002627                                 90\nUBERON:0002113          CL:0000127                                540\n                        CL:0000644                                 70\n                        CL:0002605                                 80\n                        CL:0002627                                 90","  gene_ontology_term_id  ... n_cells_tissue\n0       ENSG00000085265  ...           1000\n1       ENSG00000169429  ...           1000\n2       ENSG00000085265  ...           1000\n3       ENSG00000085265  ...           1000\n4       ENSG00000169429  ...           1000\n5       ENSG00000085265  ...           1000\n6       ENSG00000169429  ...           1000\n7       ENSG00000085265  ...           1000\n8       ENSG00000085265  ...           1000\n9       ENSG00000169429  ...           1000\n\n[10 rows x 7 columns]","                                                    n_cells_cell_type\ntissue_ontology_term_id cell_type_ontology_term_id                   \nUBERON:0000955          CL:0000127                                300\n                        CL:0000644                                 70\n                        CL:0002605                                 80\n                        CL:0002627                                 90\nUBERON:0002113          CL:0000127                                300\n                        CL:0000644                                 70\n                        CL:0002605                                 80\n                        CL:0002627                                 90","  gene_ontology_term_id  ... n_cells_tissue\n0       ENSG00000085265  ...           1000\n1       ENSG00000085265  ...           1000\n2       ENSG00000169429  ...           1000\n3       ENSG00000085265  ...           1000\n4       ENSG00000085265  ...           1000\n5       ENSG00000169429  ...           1000\n\n[6 rows x 7 columns]","'no_compare_dim_all_tissues_have_all_cell_types'"]}