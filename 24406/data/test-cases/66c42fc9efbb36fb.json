{"uid":"66c42fc9efbb36fb","name":"test__rollup[with_ethnicity_compare_dim_on_single_tissue-input_cell_counts_df4-expected_cell_counts_df4-input_gene_expr_df4-expected_gene_expr_df4]","fullName":"tests.unit.backend.wmg.api.common.test_rollup#test__rollup","historyId":"cea2ec9c99b35378700fac487d392abf","time":{"start":1747249619712,"stop":1747249619734,"duration":22},"description":"\n    Test that the `rollup` function correctly accumulates (or rolls up) gene-expression\n    values FOR EACH expressed gene and cell count values up the cell type ANCESTOR paths\n    grouped by (tissue_ontology_term_id, cell_type_ontology_term_id, <compare_dimension>).\n\n    The input:\n\n    1. A cell type ontology subgraph consisting of 4 cell types.\n\n    CL:0000127\n    ├── CL:0000644\n    ├── CL:0002605\n    └── CL:0002627\n\n    2. A gene expression dataframe consisting of expression numeric values for each\n    (gene_ontology_term_id, tissue_ontology_term_id, cell_type_ontology_term_id, <compare_dimension>) tuple.\n    3. The gene expression dataframe also holds total cell counts per tissue_ontology_term_id.\n    This value is held in a column called `n_cells_tissue`.\n    6. A cell counts dataframe that consists of cell counts for each\n    (tissue_ontology_term_id, cell_type_ontology_term_id, <compare_dimension>) tuple.\n    7. We set the `n_cells_tissue` column values to 1000 for all rows\n    in the gene expression dataframe.\n    8. We set all other numeric column values to `1` in the gene expression dataframe.\n\n    The expected output:\n\n    1. A rolled up gene expression dataframe.\n    2. A rolled up cell counts dataframe.\n    3. Assert that `n_cells_tissue` column value in the rolled up gene expression dataframe\n    does not change for all rows because it should not be rolled up the cell type ontology\n    ancestor paths.\n    4. Assert that other numeric column values (i.e the columns that are not `n_cells_tissue`)\n    in the rolled up gene expression dataframe hold the correct rolled up values.\n    5. Assert that the cell counts in the rolled up cell counts dataframe hold the correct\n    rolled up values.\n    ","descriptionHtml":"<pre><code>Test that the `rollup` function correctly accumulates (or rolls up) gene-expression\nvalues FOR EACH expressed gene and cell count values up the cell type ANCESTOR paths\ngrouped by (tissue_ontology_term_id, cell_type_ontology_term_id, &lt;compare_dimension&gt;).\n\nThe input:\n\n1. A cell type ontology subgraph consisting of 4 cell types.\n\nCL:0000127\n├── CL:0000644\n├── CL:0002605\n└── CL:0002627\n\n2. A gene expression dataframe consisting of expression numeric values for each\n(gene_ontology_term_id, tissue_ontology_term_id, cell_type_ontology_term_id, &lt;compare_dimension&gt;) tuple.\n3. The gene expression dataframe also holds total cell counts per tissue_ontology_term_id.\nThis value is held in a column called `n_cells_tissue`.\n6. A cell counts dataframe that consists of cell counts for each\n(tissue_ontology_term_id, cell_type_ontology_term_id, &lt;compare_dimension&gt;) tuple.\n7. We set the `n_cells_tissue` column values to 1000 for all rows\nin the gene expression dataframe.\n8. We set all other numeric column values to `1` in the gene expression dataframe.\n\nThe expected output:\n\n1. A rolled up gene expression dataframe.\n2. A rolled up cell counts dataframe.\n3. Assert that `n_cells_tissue` column value in the rolled up gene expression dataframe\ndoes not change for all rows because it should not be rolled up the cell type ontology\nancestor paths.\n4. Assert that other numeric column values (i.e the columns that are not `n_cells_tissue`)\nin the rolled up gene expression dataframe hold the correct rolled up values.\n5. Assert that the cell counts in the rolled up cell counts dataframe hold the correct\nrolled up values.\n</code></pre>\n","status":"passed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"patch_all","time":{"start":1747249616886,"stop":1747249616886,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"\n    Test that the `rollup` function correctly accumulates (or rolls up) gene-expression\n    values FOR EACH expressed gene and cell count values up the cell type ANCESTOR paths\n    grouped by (tissue_ontology_term_id, cell_type_ontology_term_id, <compare_dimension>).\n\n    The input:\n\n    1. A cell type ontology subgraph consisting of 4 cell types.\n\n    CL:0000127\n    ├── CL:0000644\n    ├── CL:0002605\n    └── CL:0002627\n\n    2. A gene expression dataframe consisting of expression numeric values for each\n    (gene_ontology_term_id, tissue_ontology_term_id, cell_type_ontology_term_id, <compare_dimension>) tuple.\n    3. The gene expression dataframe also holds total cell counts per tissue_ontology_term_id.\n    This value is held in a column called `n_cells_tissue`.\n    6. A cell counts dataframe that consists of cell counts for each\n    (tissue_ontology_term_id, cell_type_ontology_term_id, <compare_dimension>) tuple.\n    7. We set the `n_cells_tissue` column values to 1000 for all rows\n    in the gene expression dataframe.\n    8. We set all other numeric column values to `1` in the gene expression dataframe.\n\n    The expected output:\n\n    1. A rolled up gene expression dataframe.\n    2. A rolled up cell counts dataframe.\n    3. Assert that `n_cells_tissue` column value in the rolled up gene expression dataframe\n    does not change for all rows because it should not be rolled up the cell type ontology\n    ancestor paths.\n    4. Assert that other numeric column values (i.e the columns that are not `n_cells_tissue`)\n    in the rolled up gene expression dataframe hold the correct rolled up values.\n    5. Assert that the cell counts in the rolled up cell counts dataframe hold the correct\n    rolled up values.\n    ","status":"passed","steps":[],"attachments":[{"uid":"8bac9394a930fd55","name":"log","source":"8bac9394a930fd55.txt","type":"text/plain","size":230},{"uid":"7aae9eb410c2616b","name":"stderr","source":"7aae9eb410c2616b.txt","type":"text/plain","size":704}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":2,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"parentSuite","value":"tests.unit.backend.wmg.api.common"},{"name":"suite","value":"test_rollup"},{"name":"host","value":"b42e9d3734d5"},{"name":"thread","value":"1-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.unit.backend.wmg.api.common.test_rollup"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"expected_cell_counts_df","value":"                                                                                             n_cells_cell_type\ntissue_ontology_term_id cell_type_ontology_term_id self_reported_ethnicity_ontology_term_id                   \nUBERON:0000955          CL:0000127                 HANCESTRO:0008                                           50\n                                                   multiethnic                                              70\n                                                   unknown                                                 410\n                        CL:0000644                 unknown                                                  70\n                        CL:0002605                 HANCESTRO:0005                                           10\n                                                   HANCESTRO:0008                                           30\n                                                   multiethnic                                              40\n                        CL:0002627                 HANCESTRO:0006                                           10\n                                                   HANCESTRO:0008                                           20\n                                                   multiethnic                                              30\n                                                   unknown                                                  40"},{"name":"expected_gene_expr_df","value":"  gene_ontology_term_id  ... n_cells_tissue\n0       ENSG00000085265  ...           1000\n1       ENSG00000085265  ...           1000\n2       ENSG00000169429  ...           1000\n3       ENSG00000085265  ...           1000\n4       ENSG00000085265  ...           1000\n5       ENSG00000085265  ...           1000\n6       ENSG00000085265  ...           1000\n7       ENSG00000085265  ...           1000\n8       ENSG00000169429  ...           1000\n\n[9 rows x 8 columns]"},{"name":"input_cell_counts_df","value":"                                                                                             n_cells_cell_type\ntissue_ontology_term_id cell_type_ontology_term_id self_reported_ethnicity_ontology_term_id                   \nUBERON:0000955          CL:0000127                 unknown                                                 300\n                        CL:0000644                 unknown                                                  70\n                        CL:0002605                 HANCESTRO:0005                                           10\n                                                   HANCESTRO:0008                                           30\n                                                   multiethnic                                              40\n                        CL:0002627                 HANCESTRO:0006                                           10\n                                                   HANCESTRO:0008                                           20\n                                                   multiethnic                                              30\n                                                   unknown                                                  40"},{"name":"input_gene_expr_df","value":"  gene_ontology_term_id  ... n_cells_tissue\n0       ENSG00000085265  ...           1000\n1       ENSG00000085265  ...           1000\n2       ENSG00000085265  ...           1000\n3       ENSG00000085265  ...           1000\n4       ENSG00000169429  ...           1000\n\n[5 rows x 8 columns]"},{"name":"name","value":"'with_ethnicity_compare_dim_on_single_tissue'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[],"history":{"statistic":{"failed":0,"broken":0,"skipped":0,"passed":153,"unknown":0,"total":153},"items":[{"uid":"5806b7f8300f03b9","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24405//#testresult/5806b7f8300f03b9","status":"passed","time":{"start":1747239338696,"stop":1747239338718,"duration":22}},{"uid":"4d11ff3675325f25","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24397//#testresult/4d11ff3675325f25","status":"passed","time":{"start":1747166094361,"stop":1747166094384,"duration":23}},{"uid":"53bb707267f2d114","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24396//#testresult/53bb707267f2d114","status":"passed","time":{"start":1747159192965,"stop":1747159192988,"duration":23}},{"uid":"1081b91f901e041","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24395//#testresult/1081b91f901e041","status":"passed","time":{"start":1747158979202,"stop":1747158979225,"duration":23}},{"uid":"44d6facb698efb36","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24394//#testresult/44d6facb698efb36","status":"passed","time":{"start":1747158601395,"stop":1747158601419,"duration":24}},{"uid":"8b01416108e26829","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24378//#testresult/8b01416108e26829","status":"passed","time":{"start":1746476370079,"stop":1746476370101,"duration":22}},{"uid":"f83202caf48b4b1d","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24375//#testresult/f83202caf48b4b1d","status":"passed","time":{"start":1746471746111,"stop":1746471746135,"duration":24}},{"uid":"d41faa66c04694a5","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24374//#testresult/d41faa66c04694a5","status":"passed","time":{"start":1746470259107,"stop":1746470259130,"duration":23}},{"uid":"5eae0c02428cf84c","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24368//#testresult/5eae0c02428cf84c","status":"passed","time":{"start":1746204850098,"stop":1746204850121,"duration":23}},{"uid":"95519fa3e4a73d2a","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24360//#testresult/95519fa3e4a73d2a","status":"passed","time":{"start":1746140410501,"stop":1746140410524,"duration":23}},{"uid":"fd5daf673b497792","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24354//#testresult/fd5daf673b497792","status":"passed","time":{"start":1746133515404,"stop":1746133515428,"duration":24}},{"uid":"afb3ba296ba5b474","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24353//#testresult/afb3ba296ba5b474","status":"passed","time":{"start":1745942469941,"stop":1745942469965,"duration":24}},{"uid":"88323a4fbaf8d879","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24352//#testresult/88323a4fbaf8d879","status":"passed","time":{"start":1745873135900,"stop":1745873135924,"duration":24}},{"uid":"eee00e1d4ae4a636","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24344//#testresult/eee00e1d4ae4a636","status":"passed","time":{"start":1745870330402,"stop":1745870330424,"duration":22}},{"uid":"956602232c10f252","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24338//#testresult/956602232c10f252","status":"passed","time":{"start":1745865203293,"stop":1745865203315,"duration":22}},{"uid":"a30202d80b79738d","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24326//#testresult/a30202d80b79738d","status":"passed","time":{"start":1745525970415,"stop":1745525970439,"duration":24}},{"uid":"bf8a78ecb54b1ec","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24325//#testresult/bf8a78ecb54b1ec","status":"passed","time":{"start":1745519932190,"stop":1745519932213,"duration":23}},{"uid":"a78ad41b97c93e4","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24324//#testresult/a78ad41b97c93e4","status":"passed","time":{"start":1745514442814,"stop":1745514442837,"duration":23}},{"uid":"da546e64d0cb566a","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24317//#testresult/da546e64d0cb566a","status":"passed","time":{"start":1745504667807,"stop":1745504667830,"duration":23}},{"uid":"be86e0f339266e9a","reportUrl":"https://chanzuckerberg.github.io/single-cell-data-portal/24312//#testresult/be86e0f339266e9a","status":"passed","time":{"start":1745503635469,"stop":1745503635495,"duration":26}}]},"tags":[]},"source":"66c42fc9efbb36fb.json","parameterValues":["                                                                                             n_cells_cell_type\ntissue_ontology_term_id cell_type_ontology_term_id self_reported_ethnicity_ontology_term_id                   \nUBERON:0000955          CL:0000127                 HANCESTRO:0008                                           50\n                                                   multiethnic                                              70\n                                                   unknown                                                 410\n                        CL:0000644                 unknown                                                  70\n                        CL:0002605                 HANCESTRO:0005                                           10\n                                                   HANCESTRO:0008                                           30\n                                                   multiethnic                                              40\n                        CL:0002627                 HANCESTRO:0006                                           10\n                                                   HANCESTRO:0008                                           20\n                                                   multiethnic                                              30\n                                                   unknown                                                  40","  gene_ontology_term_id  ... n_cells_tissue\n0       ENSG00000085265  ...           1000\n1       ENSG00000085265  ...           1000\n2       ENSG00000169429  ...           1000\n3       ENSG00000085265  ...           1000\n4       ENSG00000085265  ...           1000\n5       ENSG00000085265  ...           1000\n6       ENSG00000085265  ...           1000\n7       ENSG00000085265  ...           1000\n8       ENSG00000169429  ...           1000\n\n[9 rows x 8 columns]","                                                                                             n_cells_cell_type\ntissue_ontology_term_id cell_type_ontology_term_id self_reported_ethnicity_ontology_term_id                   \nUBERON:0000955          CL:0000127                 unknown                                                 300\n                        CL:0000644                 unknown                                                  70\n                        CL:0002605                 HANCESTRO:0005                                           10\n                                                   HANCESTRO:0008                                           30\n                                                   multiethnic                                              40\n                        CL:0002627                 HANCESTRO:0006                                           10\n                                                   HANCESTRO:0008                                           20\n                                                   multiethnic                                              30\n                                                   unknown                                                  40","  gene_ontology_term_id  ... n_cells_tissue\n0       ENSG00000085265  ...           1000\n1       ENSG00000085265  ...           1000\n2       ENSG00000085265  ...           1000\n3       ENSG00000085265  ...           1000\n4       ENSG00000169429  ...           1000\n\n[5 rows x 8 columns]","'with_ethnicity_compare_dim_on_single_tissue'"]}