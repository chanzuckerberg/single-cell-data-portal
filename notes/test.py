import json
with open("./execution-details.json") as fp:
    sfn = json.load(fp)

def get_previous_event(events, event):
    return events[str(event["previousEventId"])]

def get_failure_details(events, event):
    previous = get_previous_event(events, event)
    for i in range(8):
        previous = get_previous_event(events, previous)
    return previous

failed = [x for x in sfn["historyHash"].values() if x["type"] == "TaskFailed"]
failed_datasets = [x for x in failed if x["stepName"] != "CollectionPublish"]
causes = [json.loads(x["taskFailedEventDetails"]["cause"]) for x in failed_datasets]

failure_details=[]
for f in failed_datasets:
    failure_details.append(get_failure_details(sfn["historyHash"], failed_datasets[0])["taskScheduledEventDetails"][
        "parameters"][
        "ContainerOverrides"]["Environment"])

[[{'Name': 'MANAGED_BY_AWS', 'Value': 'STARTED_BY_STEP_FUNCTIONS'}, {'Name': 'STEP_NAME', 'Value': 'dataset_migrate'}, {'Name': 'MIGRATE', 'Value': 'True'}, {'Name': 'DATASET_ID', 'Value': 'a1ea7856-890f-4ec4-8fd9-2b6354daa6a7'}, {'Name': 'DATASET_VERSION_ID', 'Value': '6c2fa813-bd71-40c6-b36d-9c62e50cabee'}, {'Name': 'COLLECTION_VERSION_ID', 'Value': 'f7b08e12-e513-49ba-a29e-b927aa906115'}, {'Name': 'COLLECTION_ID', 'Value': 'e2c257e7-6f79-487c-b81c-39451cd4ab3c'}, {'Name': 'TASK_TOKEN', 'Value': 'AQCQAAAAKgAAAAMAAAAAAAAAAdAX0QFPmx0uXtD03RCszaNIQGc9sfKo34QL/gBpwNdPAfAApttCiVKDzcfKlZ4reIPgys1k+RzkGhcfzN9/Ou0iFOFx4nZ5SCqfEYMRjptNr9MmV2aBYlBLpPJsV9JIWrHpLCLuIwRanSF2YlBo0tUh7asw27WS1JMCe/T3+1ZcXVRAczAZruKs7RV0itOEZDdFCyBu/e1loHZDugGdzy60Al1eIqKfKQiaLX4PsvfyiT2BCG2edu81SUOL6XPTY2N95yoY8oHQJQ6yY1ri9Dz8fog/udzS8R/IhfxnjIhPILVkk2lr45c7U0a1niSK+EDPw/cI+aDfgYu9h5McfxoJU39x2IjebSa1rrjPFofGHk6/cwMTTszIHXW874UJDl7uOoBgUkI5RNWQpbxDe9w7LLwlFpV3FjzcEETC3zJlt8RroVaI0WDdXw0qu3RQGKWr3MOv4BQpPO0YCkb6eqkvUYIGnmot1tx9AcWhKbMIZ7lb6yRz1QXeKUeTRgwOi69E+ewPZ7rBpTRmTW/k2FkQkqamsEjmbaDDWtm1V3TFTl0TJeR/cavnSMDZmGlKp6GUdYDfnUkBANeasrEg9IkRTk4ST2/2RAytg+QKPwTcTauw4r7NZGQ8B3pokYGKdepd0qYm6JcwH5GD'}, {'Name': 'EXECUTION_ID', 'Value': '89e38d85-ebc2-4f7b-ad49-c0b4ea00fcad'}], [{'Name': 'MANAGED_BY_AWS', 'Value': 'STARTED_BY_STEP_FUNCTIONS'}, {'Name': 'STEP_NAME', 'Value': 'dataset_migrate'}, {'Name': 'MIGRATE', 'Value': 'True'}, {'Name': 'DATASET_ID', 'Value': 'a1ea7856-890f-4ec4-8fd9-2b6354daa6a7'}, {'Name': 'DATASET_VERSION_ID', 'Value': '6c2fa813-bd71-40c6-b36d-9c62e50cabee'}, {'Name': 'COLLECTION_VERSION_ID', 'Value': 'f7b08e12-e513-49ba-a29e-b927aa906115'}, {'Name': 'COLLECTION_ID', 'Value': 'e2c257e7-6f79-487c-b81c-39451cd4ab3c'}, {'Name': 'TASK_TOKEN', 'Value': 'AQCQAAAAKgAAAAMAAAAAAAAAAdAX0QFPmx0uXtD03RCszaNIQGc9sfKo34QL/gBpwNdPAfAApttCiVKDzcfKlZ4reIPgys1k+RzkGhcfzN9/Ou0iFOFx4nZ5SCqfEYMRjptNr9MmV2aBYlBLpPJsV9JIWrHpLCLuIwRanSF2YlBo0tUh7asw27WS1JMCe/T3+1ZcXVRAczAZruKs7RV0itOEZDdFCyBu/e1loHZDugGdzy60Al1eIqKfKQiaLX4PsvfyiT2BCG2edu81SUOL6XPTY2N95yoY8oHQJQ6yY1ri9Dz8fog/udzS8R/IhfxnjIhPILVkk2lr45c7U0a1niSK+EDPw/cI+aDfgYu9h5McfxoJU39x2IjebSa1rrjPFofGHk6/cwMTTszIHXW874UJDl7uOoBgUkI5RNWQpbxDe9w7LLwlFpV3FjzcEETC3zJlt8RroVaI0WDdXw0qu3RQGKWr3MOv4BQpPO0YCkb6eqkvUYIGnmot1tx9AcWhKbMIZ7lb6yRz1QXeKUeTRgwOi69E+ewPZ7rBpTRmTW/k2FkQkqamsEjmbaDDWtm1V3TFTl0TJeR/cavnSMDZmGlKp6GUdYDfnUkBANeasrEg9IkRTk4ST2/2RAytg+QKPwTcTauw4r7NZGQ8B3pokYGKdepd0qYm6JcwH5GD'}, {'Name': 'EXECUTION_ID', 'Value': '89e38d85-ebc2-4f7b-ad49-c0b4ea00fcad'}], [{'Name': 'MANAGED_BY_AWS', 'Value': 'STARTED_BY_STEP_FUNCTIONS'}, {'Name': 'STEP_NAME', 'Value': 'dataset_migrate'}, {'Name': 'MIGRATE', 'Value': 'True'}, {'Name': 'DATASET_ID', 'Value': 'a1ea7856-890f-4ec4-8fd9-2b6354daa6a7'}, {'Name': 'DATASET_VERSION_ID', 'Value': '6c2fa813-bd71-40c6-b36d-9c62e50cabee'}, {'Name': 'COLLECTION_VERSION_ID', 'Value': 'f7b08e12-e513-49ba-a29e-b927aa906115'}, {'Name': 'COLLECTION_ID', 'Value': 'e2c257e7-6f79-487c-b81c-39451cd4ab3c'}, {'Name': 'TASK_TOKEN', 'Value': 'AQCQAAAAKgAAAAMAAAAAAAAAAdAX0QFPmx0uXtD03RCszaNIQGc9sfKo34QL/gBpwNdPAfAApttCiVKDzcfKlZ4reIPgys1k+RzkGhcfzN9/Ou0iFOFx4nZ5SCqfEYMRjptNr9MmV2aBYlBLpPJsV9JIWrHpLCLuIwRanSF2YlBo0tUh7asw27WS1JMCe/T3+1ZcXVRAczAZruKs7RV0itOEZDdFCyBu/e1loHZDugGdzy60Al1eIqKfKQiaLX4PsvfyiT2BCG2edu81SUOL6XPTY2N95yoY8oHQJQ6yY1ri9Dz8fog/udzS8R/IhfxnjIhPILVkk2lr45c7U0a1niSK+EDPw/cI+aDfgYu9h5McfxoJU39x2IjebSa1rrjPFofGHk6/cwMTTszIHXW874UJDl7uOoBgUkI5RNWQpbxDe9w7LLwlFpV3FjzcEETC3zJlt8RroVaI0WDdXw0qu3RQGKWr3MOv4BQpPO0YCkb6eqkvUYIGnmot1tx9AcWhKbMIZ7lb6yRz1QXeKUeTRgwOi69E+ewPZ7rBpTRmTW/k2FkQkqamsEjmbaDDWtm1V3TFTl0TJeR/cavnSMDZmGlKp6GUdYDfnUkBANeasrEg9IkRTk4ST2/2RAytg+QKPwTcTauw4r7NZGQ8B3pokYGKdepd0qYm6JcwH5GD'}, {'Name': 'EXECUTION_ID', 'Value': '89e38d85-ebc2-4f7b-ad49-c0b4ea00fcad'}], [{'Name': 'MANAGED_BY_AWS', 'Value': 'STARTED_BY_STEP_FUNCTIONS'}, {'Name': 'STEP_NAME', 'Value': 'dataset_migrate'}, {'Name': 'MIGRATE', 'Value': 'True'}, {'Name': 'DATASET_ID', 'Value': 'a1ea7856-890f-4ec4-8fd9-2b6354daa6a7'}, {'Name': 'DATASET_VERSION_ID', 'Value': '6c2fa813-bd71-40c6-b36d-9c62e50cabee'}, {'Name': 'COLLECTION_VERSION_ID', 'Value': 'f7b08e12-e513-49ba-a29e-b927aa906115'}, {'Name': 'COLLECTION_ID', 'Value': 'e2c257e7-6f79-487c-b81c-39451cd4ab3c'}, {'Name': 'TASK_TOKEN', 'Value': 'AQCQAAAAKgAAAAMAAAAAAAAAAdAX0QFPmx0uXtD03RCszaNIQGc9sfKo34QL/gBpwNdPAfAApttCiVKDzcfKlZ4reIPgys1k+RzkGhcfzN9/Ou0iFOFx4nZ5SCqfEYMRjptNr9MmV2aBYlBLpPJsV9JIWrHpLCLuIwRanSF2YlBo0tUh7asw27WS1JMCe/T3+1ZcXVRAczAZruKs7RV0itOEZDdFCyBu/e1loHZDugGdzy60Al1eIqKfKQiaLX4PsvfyiT2BCG2edu81SUOL6XPTY2N95yoY8oHQJQ6yY1ri9Dz8fog/udzS8R/IhfxnjIhPILVkk2lr45c7U0a1niSK+EDPw/cI+aDfgYu9h5McfxoJU39x2IjebSa1rrjPFofGHk6/cwMTTszIHXW874UJDl7uOoBgUkI5RNWQpbxDe9w7LLwlFpV3FjzcEETC3zJlt8RroVaI0WDdXw0qu3RQGKWr3MOv4BQpPO0YCkb6eqkvUYIGnmot1tx9AcWhKbMIZ7lb6yRz1QXeKUeTRgwOi69E+ewPZ7rBpTRmTW/k2FkQkqamsEjmbaDDWtm1V3TFTl0TJeR/cavnSMDZmGlKp6GUdYDfnUkBANeasrEg9IkRTk4ST2/2RAytg+QKPwTcTauw4r7NZGQ8B3pokYGKdepd0qYm6JcwH5GD'}, {'Name': 'EXECUTION_ID', 'Value': '89e38d85-ebc2-4f7b-ad49-c0b4ea00fcad'}], [{'Name': 'MANAGED_BY_AWS', 'Value': 'STARTED_BY_STEP_FUNCTIONS'}, {'Name': 'STEP_NAME', 'Value': 'dataset_migrate'}, {'Name': 'MIGRATE', 'Value': 'True'}, {'Name': 'DATASET_ID', 'Value': 'a1ea7856-890f-4ec4-8fd9-2b6354daa6a7'}, {'Name': 'DATASET_VERSION_ID', 'Value': '6c2fa813-bd71-40c6-b36d-9c62e50cabee'}, {'Name': 'COLLECTION_VERSION_ID', 'Value': 'f7b08e12-e513-49ba-a29e-b927aa906115'}, {'Name': 'COLLECTION_ID', 'Value': 'e2c257e7-6f79-487c-b81c-39451cd4ab3c'}, {'Name': 'TASK_TOKEN', 'Value': 'AQCQAAAAKgAAAAMAAAAAAAAAAdAX0QFPmx0uXtD03RCszaNIQGc9sfKo34QL/gBpwNdPAfAApttCiVKDzcfKlZ4reIPgys1k+RzkGhcfzN9/Ou0iFOFx4nZ5SCqfEYMRjptNr9MmV2aBYlBLpPJsV9JIWrHpLCLuIwRanSF2YlBo0tUh7asw27WS1JMCe/T3+1ZcXVRAczAZruKs7RV0itOEZDdFCyBu/e1loHZDugGdzy60Al1eIqKfKQiaLX4PsvfyiT2BCG2edu81SUOL6XPTY2N95yoY8oHQJQ6yY1ri9Dz8fog/udzS8R/IhfxnjIhPILVkk2lr45c7U0a1niSK+EDPw/cI+aDfgYu9h5McfxoJU39x2IjebSa1rrjPFofGHk6/cwMTTszIHXW874UJDl7uOoBgUkI5RNWQpbxDe9w7LLwlFpV3FjzcEETC3zJlt8RroVaI0WDdXw0qu3RQGKWr3MOv4BQpPO0YCkb6eqkvUYIGnmot1tx9AcWhKbMIZ7lb6yRz1QXeKUeTRgwOi69E+ewPZ7rBpTRmTW/k2FkQkqamsEjmbaDDWtm1V3TFTl0TJeR/cavnSMDZmGlKp6GUdYDfnUkBANeasrEg9IkRTk4ST2/2RAytg+QKPwTcTauw4r7NZGQ8B3pokYGKdepd0qYm6JcwH5GD'}, {'Name': 'EXECUTION_ID', 'Value': '89e38d85-ebc2-4f7b-ad49-c0b4ea00fcad'}], [{'Name': 'MANAGED_BY_AWS', 'Value': 'STARTED_BY_STEP_FUNCTIONS'}, {'Name': 'STEP_NAME', 'Value': 'dataset_migrate'}, {'Name': 'MIGRATE', 'Value': 'True'}, {'Name': 'DATASET_ID', 'Value': 'a1ea7856-890f-4ec4-8fd9-2b6354daa6a7'}, {'Name': 'DATASET_VERSION_ID', 'Value': '6c2fa813-bd71-40c6-b36d-9c62e50cabee'}, {'Name': 'COLLECTION_VERSION_ID', 'Value': 'f7b08e12-e513-49ba-a29e-b927aa906115'}, {'Name': 'COLLECTION_ID', 'Value': 'e2c257e7-6f79-487c-b81c-39451cd4ab3c'}, {'Name': 'TASK_TOKEN', 'Value': 'AQCQAAAAKgAAAAMAAAAAAAAAAdAX0QFPmx0uXtD03RCszaNIQGc9sfKo34QL/gBpwNdPAfAApttCiVKDzcfKlZ4reIPgys1k+RzkGhcfzN9/Ou0iFOFx4nZ5SCqfEYMRjptNr9MmV2aBYlBLpPJsV9JIWrHpLCLuIwRanSF2YlBo0tUh7asw27WS1JMCe/T3+1ZcXVRAczAZruKs7RV0itOEZDdFCyBu/e1loHZDugGdzy60Al1eIqKfKQiaLX4PsvfyiT2BCG2edu81SUOL6XPTY2N95yoY8oHQJQ6yY1ri9Dz8fog/udzS8R/IhfxnjIhPILVkk2lr45c7U0a1niSK+EDPw/cI+aDfgYu9h5McfxoJU39x2IjebSa1rrjPFofGHk6/cwMTTszIHXW874UJDl7uOoBgUkI5RNWQpbxDe9w7LLwlFpV3FjzcEETC3zJlt8RroVaI0WDdXw0qu3RQGKWr3MOv4BQpPO0YCkb6eqkvUYIGnmot1tx9AcWhKbMIZ7lb6yRz1QXeKUeTRgwOi69E+ewPZ7rBpTRmTW/k2FkQkqamsEjmbaDDWtm1V3TFTl0TJeR/cavnSMDZmGlKp6GUdYDfnUkBANeasrEg9IkRTk4ST2/2RAytg+QKPwTcTauw4r7NZGQ8B3pokYGKdepd0qYm6JcwH5GD'}, {'Name': 'EXECUTION_ID', 'Value': '89e38d85-ebc2-4f7b-ad49-c0b4ea00fcad'}], [{'Name': 'MANAGED_BY_AWS', 'Value': 'STARTED_BY_STEP_FUNCTIONS'}, {'Name': 'STEP_NAME', 'Value': 'dataset_migrate'}, {'Name': 'MIGRATE', 'Value': 'True'}, {'Name': 'DATASET_ID', 'Value': 'a1ea7856-890f-4ec4-8fd9-2b6354daa6a7'}, {'Name': 'DATASET_VERSION_ID', 'Value': '6c2fa813-bd71-40c6-b36d-9c62e50cabee'}, {'Name': 'COLLECTION_VERSION_ID', 'Value': 'f7b08e12-e513-49ba-a29e-b927aa906115'}, {'Name': 'COLLECTION_ID', 'Value': 'e2c257e7-6f79-487c-b81c-39451cd4ab3c'}, {'Name': 'TASK_TOKEN', 'Value': 'AQCQAAAAKgAAAAMAAAAAAAAAAdAX0QFPmx0uXtD03RCszaNIQGc9sfKo34QL/gBpwNdPAfAApttCiVKDzcfKlZ4reIPgys1k+RzkGhcfzN9/Ou0iFOFx4nZ5SCqfEYMRjptNr9MmV2aBYlBLpPJsV9JIWrHpLCLuIwRanSF2YlBo0tUh7asw27WS1JMCe/T3+1ZcXVRAczAZruKs7RV0itOEZDdFCyBu/e1loHZDugGdzy60Al1eIqKfKQiaLX4PsvfyiT2BCG2edu81SUOL6XPTY2N95yoY8oHQJQ6yY1ri9Dz8fog/udzS8R/IhfxnjIhPILVkk2lr45c7U0a1niSK+EDPw/cI+aDfgYu9h5McfxoJU39x2IjebSa1rrjPFofGHk6/cwMTTszIHXW874UJDl7uOoBgUkI5RNWQpbxDe9w7LLwlFpV3FjzcEETC3zJlt8RroVaI0WDdXw0qu3RQGKWr3MOv4BQpPO0YCkb6eqkvUYIGnmot1tx9AcWhKbMIZ7lb6yRz1QXeKUeTRgwOi69E+ewPZ7rBpTRmTW/k2FkQkqamsEjmbaDDWtm1V3TFTl0TJeR/cavnSMDZmGlKp6GUdYDfnUkBANeasrEg9IkRTk4ST2/2RAytg+QKPwTcTauw4r7NZGQ8B3pokYGKdepd0qYm6JcwH5GD'}, {'Name': 'EXECUTION_ID', 'Value': '89e38d85-ebc2-4f7b-ad49-c0b4ea00fcad'}], [{'Name': 'MANAGED_BY_AWS', 'Value': 'STARTED_BY_STEP_FUNCTIONS'}, {'Name': 'STEP_NAME', 'Value': 'dataset_migrate'}, {'Name': 'MIGRATE', 'Value': 'True'}, {'Name': 'DATASET_ID', 'Value': 'a1ea7856-890f-4ec4-8fd9-2b6354daa6a7'}, {'Name': 'DATASET_VERSION_ID', 'Value': '6c2fa813-bd71-40c6-b36d-9c62e50cabee'}, {'Name': 'COLLECTION_VERSION_ID', 'Value': 'f7b08e12-e513-49ba-a29e-b927aa906115'}, {'Name': 'COLLECTION_ID', 'Value': 'e2c257e7-6f79-487c-b81c-39451cd4ab3c'}, {'Name': 'TASK_TOKEN', 'Value': 'AQCQAAAAKgAAAAMAAAAAAAAAAdAX0QFPmx0uXtD03RCszaNIQGc9sfKo34QL/gBpwNdPAfAApttCiVKDzcfKlZ4reIPgys1k+RzkGhcfzN9/Ou0iFOFx4nZ5SCqfEYMRjptNr9MmV2aBYlBLpPJsV9JIWrHpLCLuIwRanSF2YlBo0tUh7asw27WS1JMCe/T3+1ZcXVRAczAZruKs7RV0itOEZDdFCyBu/e1loHZDugGdzy60Al1eIqKfKQiaLX4PsvfyiT2BCG2edu81SUOL6XPTY2N95yoY8oHQJQ6yY1ri9Dz8fog/udzS8R/IhfxnjIhPILVkk2lr45c7U0a1niSK+EDPw/cI+aDfgYu9h5McfxoJU39x2IjebSa1rrjPFofGHk6/cwMTTszIHXW874UJDl7uOoBgUkI5RNWQpbxDe9w7LLwlFpV3FjzcEETC3zJlt8RroVaI0WDdXw0qu3RQGKWr3MOv4BQpPO0YCkb6eqkvUYIGnmot1tx9AcWhKbMIZ7lb6yRz1QXeKUeTRgwOi69E+ewPZ7rBpTRmTW/k2FkQkqamsEjmbaDDWtm1V3TFTl0TJeR/cavnSMDZmGlKp6GUdYDfnUkBANeasrEg9IkRTk4ST2/2RAytg+QKPwTcTauw4r7NZGQ8B3pokYGKdepd0qYm6JcwH5GD'}, {'Name': 'EXECUTION_ID', 'Value': '89e38d85-ebc2-4f7b-ad49-c0b4ea00fcad'}]]
