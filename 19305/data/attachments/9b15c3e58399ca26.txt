{"levelname": "INFO", "asctime": "2024-04-01T15:29:28.001Z", "name": "root", "message": "", "lineno": 22, "pathname": "/single-cell-data-portal/backend/layers/processing/upload_failures/app.py", "dataset_version_id": "123", "collection_version_id": "456", "error": {}, "execution_id": "arn:aws:states:us-west-2:123456789012:execution:MyStateMachine"}
{"levelname": "ERROR", "asctime": "2024-04-01T15:29:39.001Z", "name": "processing", "message": "Failed to update dataset processing status", "lineno": 41, "pathname": "/single-cell-data-portal/backend/layers/processing/logger.py", "exc_info": "Traceback (most recent call last):\n  File \"/usr/lib/python3/dist-packages/urllib3/connection.py\", line 159, in _new_conn\n    conn = connection.create_connection(\n  File \"/usr/lib/python3/dist-packages/urllib3/util/connection.py\", line 61, in create_connection\n    for res in socket.getaddrinfo(host, port, family, socket.SOCK_STREAM):\n  File \"/usr/lib/python3.8/socket.py\", line 918, in getaddrinfo\n    for res in _socket.getaddrinfo(host, port, family, type, proto, flags):\nsocket.gaierror: [Errno -2] Name or service not known\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/httpsession.py\", line 464, in send\n    urllib_response = conn.urlopen(\n  File \"/usr/lib/python3/dist-packages/urllib3/connectionpool.py\", line 720, in urlopen\n    retries = retries.increment(\n  File \"/usr/lib/python3/dist-packages/urllib3/util/retry.py\", line 376, in increment\n    raise six.reraise(type(error), error, _stacktrace)\n  File \"/usr/lib/python3/dist-packages/six.py\", line 703, in reraise\n    raise value\n  File \"/usr/lib/python3/dist-packages/urllib3/connectionpool.py\", line 666, in urlopen\n    httplib_response = self._make_request(\n  File \"/usr/lib/python3/dist-packages/urllib3/connectionpool.py\", line 388, in _make_request\n    conn.request(method, url, **httplib_request_kw)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/awsrequest.py\", line 96, in request\n    rval = super().request(method, url, body, headers, *args, **kwargs)\n  File \"/usr/lib/python3.8/http/client.py\", line 1256, in request\n    self._send_request(method, url, body, headers, encode_chunked)\n  File \"/usr/lib/python3.8/http/client.py\", line 1302, in _send_request\n    self.endheaders(body, encode_chunked=encode_chunked)\n  File \"/usr/lib/python3.8/http/client.py\", line 1251, in endheaders\n    self._send_output(message_body, encode_chunked=encode_chunked)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/awsrequest.py\", line 123, in _send_output\n    self.send(msg)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/awsrequest.py\", line 223, in send\n    return super().send(str)\n  File \"/usr/lib/python3.8/http/client.py\", line 951, in send\n    self.connect()\n  File \"/usr/lib/python3/dist-packages/urllib3/connection.py\", line 187, in connect\n    conn = self._new_conn()\n  File \"/usr/lib/python3/dist-packages/urllib3/connection.py\", line 171, in _new_conn\n    raise NewConnectionError(\nurllib3.exceptions.NewConnectionError: <botocore.awsrequest.AWSHTTPConnection object at 0x7f4a842da0d0>: Failed to establish a new connection: [Errno -2] Name or service not known\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/single-cell-data-portal/backend/layers/processing/upload_failures/app.py\", line 87, in update_dataset_processing_status_to_failed\n    get_business_logic().update_dataset_version_status(\n  File \"/single-cell-data-portal/backend/portal/api/providers.py\", line 18, in get_business_logic\n    DatabaseProvider(),\n  File \"/single-cell-data-portal/backend/layers/persistence/persistence.py\", line 56, in __init__\n    database_uri = CorporaDbConfig().database_uri\n  File \"/single-cell-data-portal/backend/common/utils/secret_config.py\", line 54, in __getattr__\n    self.load()\n  File \"/single-cell-data-portal/backend/common/utils/secret_config.py\", line 88, in load\n    self.load_from_aws()\n  File \"/single-cell-data-portal/backend/common/utils/secret_config.py\", line 99, in load_from_aws\n    secret = AwsSecret(secret_path)\n  File \"/single-cell-data-portal/backend/common/utils/aws.py\", line 31, in __init__\n    self._load()\n  File \"/single-cell-data-portal/backend/common/utils/aws.py\", line 76, in _load\n    response = self.secrets_mgr.describe_secret(SecretId=self.name)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/client.py\", line 565, in _api_call\n    return self._make_api_call(operation_name, kwargs)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/client.py\", line 1001, in _make_api_call\n    http, parsed_response = self._make_request(\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/client.py\", line 1027, in _make_request\n    return self._endpoint.make_request(operation_model, request_dict)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/endpoint.py\", line 119, in make_request\n    return self._send_request(request_dict, operation_model)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/endpoint.py\", line 202, in _send_request\n    while self._needs_retry(\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/endpoint.py\", line 354, in _needs_retry\n    responses = self._event_emitter.emit(\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/hooks.py\", line 412, in emit\n    return self._emitter.emit(aliased_event_name, **kwargs)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/hooks.py\", line 256, in emit\n    return self._emit(event_name, kwargs)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/hooks.py\", line 239, in _emit\n    response = handler(**kwargs)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/retryhandler.py\", line 207, in __call__\n    if self._checker(**checker_kwargs):\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/retryhandler.py\", line 284, in __call__\n    should_retry = self._should_retry(\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/retryhandler.py\", line 320, in _should_retry\n    return self._checker(attempt_number, response, caught_exception)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/retryhandler.py\", line 363, in __call__\n    checker_response = checker(\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/retryhandler.py\", line 247, in __call__\n    return self._check_caught_exception(\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/retryhandler.py\", line 416, in _check_caught_exception\n    raise caught_exception\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/endpoint.py\", line 281, in _do_get_response\n    http_response = self._send(request)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/endpoint.py\", line 377, in _send\n    return self.http_session.send(request)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/httpsession.py\", line 493, in send\n    raise EndpointConnectionError(endpoint_url=request.url, error=e)\nbotocore.exceptions.EndpointConnectionError: Could not connect to the endpoint URL: \"http://localstack:4566/\""}
{"levelname": "ERROR", "asctime": "2024-04-01T15:29:47.001Z", "name": "processing", "message": "Failed to clean up artifacts.", "lineno": 41, "pathname": "/single-cell-data-portal/backend/layers/processing/logger.py", "exc_info": "Traceback (most recent call last):\n  File \"/usr/lib/python3/dist-packages/urllib3/connection.py\", line 159, in _new_conn\n    conn = connection.create_connection(\n  File \"/usr/lib/python3/dist-packages/urllib3/util/connection.py\", line 61, in create_connection\n    for res in socket.getaddrinfo(host, port, family, socket.SOCK_STREAM):\n  File \"/usr/lib/python3.8/socket.py\", line 918, in getaddrinfo\n    for res in _socket.getaddrinfo(host, port, family, type, proto, flags):\nsocket.gaierror: [Errno -2] Name or service not known\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/httpsession.py\", line 464, in send\n    urllib_response = conn.urlopen(\n  File \"/usr/lib/python3/dist-packages/urllib3/connectionpool.py\", line 720, in urlopen\n    retries = retries.increment(\n  File \"/usr/lib/python3/dist-packages/urllib3/util/retry.py\", line 376, in increment\n    raise six.reraise(type(error), error, _stacktrace)\n  File \"/usr/lib/python3/dist-packages/six.py\", line 703, in reraise\n    raise value\n  File \"/usr/lib/python3/dist-packages/urllib3/connectionpool.py\", line 666, in urlopen\n    httplib_response = self._make_request(\n  File \"/usr/lib/python3/dist-packages/urllib3/connectionpool.py\", line 388, in _make_request\n    conn.request(method, url, **httplib_request_kw)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/awsrequest.py\", line 96, in request\n    rval = super().request(method, url, body, headers, *args, **kwargs)\n  File \"/usr/lib/python3.8/http/client.py\", line 1256, in request\n    self._send_request(method, url, body, headers, encode_chunked)\n  File \"/usr/lib/python3.8/http/client.py\", line 1302, in _send_request\n    self.endheaders(body, encode_chunked=encode_chunked)\n  File \"/usr/lib/python3.8/http/client.py\", line 1251, in endheaders\n    self._send_output(message_body, encode_chunked=encode_chunked)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/awsrequest.py\", line 123, in _send_output\n    self.send(msg)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/awsrequest.py\", line 223, in send\n    return super().send(str)\n  File \"/usr/lib/python3.8/http/client.py\", line 951, in send\n    self.connect()\n  File \"/usr/lib/python3/dist-packages/urllib3/connection.py\", line 187, in connect\n    conn = self._new_conn()\n  File \"/usr/lib/python3/dist-packages/urllib3/connection.py\", line 171, in _new_conn\n    raise NewConnectionError(\nurllib3.exceptions.NewConnectionError: <botocore.awsrequest.AWSHTTPConnection object at 0x7f4a4af322e0>: Failed to establish a new connection: [Errno -2] Name or service not known\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/single-cell-data-portal/backend/layers/processing/upload_failures/app.py\", line 192, in cleanup_artifacts\n    delete_many_from_s3(artifact_bucket, object_key + \"/\")\n  File \"/single-cell-data-portal/backend/common/utils/aws.py\", line 107, in delete_many_from_s3\n    bucket.objects.filter(Prefix=f\"{prefix}\").delete()\n  File \"/usr/local/lib/python3.8/dist-packages/boto3/resources/collection.py\", line 561, in batch_action\n    return action(self, *args, **kwargs)\n  File \"/usr/local/lib/python3.8/dist-packages/boto3/resources/action.py\", line 134, in __call__\n    for page in parent.pages():\n  File \"/usr/local/lib/python3.8/dist-packages/boto3/resources/collection.py\", line 171, in pages\n    for page in pages:\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/paginate.py\", line 269, in __iter__\n    response = self._make_request(current_kwargs)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/paginate.py\", line 357, in _make_request\n    return self._method(**current_kwargs)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/client.py\", line 565, in _api_call\n    return self._make_api_call(operation_name, kwargs)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/client.py\", line 1001, in _make_api_call\n    http, parsed_response = self._make_request(\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/client.py\", line 1027, in _make_request\n    return self._endpoint.make_request(operation_model, request_dict)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/endpoint.py\", line 119, in make_request\n    return self._send_request(request_dict, operation_model)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/endpoint.py\", line 202, in _send_request\n    while self._needs_retry(\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/endpoint.py\", line 354, in _needs_retry\n    responses = self._event_emitter.emit(\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/hooks.py\", line 412, in emit\n    return self._emitter.emit(aliased_event_name, **kwargs)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/hooks.py\", line 256, in emit\n    return self._emit(event_name, kwargs)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/hooks.py\", line 239, in _emit\n    response = handler(**kwargs)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/retryhandler.py\", line 207, in __call__\n    if self._checker(**checker_kwargs):\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/retryhandler.py\", line 284, in __call__\n    should_retry = self._should_retry(\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/retryhandler.py\", line 320, in _should_retry\n    return self._checker(attempt_number, response, caught_exception)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/retryhandler.py\", line 363, in __call__\n    checker_response = checker(\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/retryhandler.py\", line 247, in __call__\n    return self._check_caught_exception(\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/retryhandler.py\", line 416, in _check_caught_exception\n    raise caught_exception\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/endpoint.py\", line 281, in _do_get_response\n    http_response = self._send(request)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/endpoint.py\", line 377, in _send\n    return self.http_session.send(request)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/httpsession.py\", line 493, in send\n    raise EndpointConnectionError(endpoint_url=request.url, error=e)\nbotocore.exceptions.EndpointConnectionError: Could not connect to the endpoint URL: \"http://localstack:4566/artifact-bucket?prefix=123%2F&encoding-type=url\""}
{"levelname": "ERROR", "asctime": "2024-04-01T15:29:47.001Z", "name": "processing", "message": "Failed to clean up datasets.", "lineno": 41, "pathname": "/single-cell-data-portal/backend/layers/processing/logger.py", "exc_info": "Traceback (most recent call last):\n  File \"/single-cell-data-portal/backend/layers/processing/upload_failures/app.py\", line 194, in cleanup_artifacts\n    datasets_bucket = os.environ[\"DATASETS_BUCKET\"]\n  File \"/usr/lib/python3.8/os.py\", line 675, in __getitem__\n    raise KeyError(key) from None\nKeyError: 'DATASETS_BUCKET'"}
{"levelname": "ERROR", "asctime": "2024-04-01T15:29:52.001Z", "name": "processing", "message": "Failed to clean up cxgs.", "lineno": 41, "pathname": "/single-cell-data-portal/backend/layers/processing/logger.py", "exc_info": "Traceback (most recent call last):\n  File \"/usr/lib/python3/dist-packages/urllib3/connection.py\", line 159, in _new_conn\n    conn = connection.create_connection(\n  File \"/usr/lib/python3/dist-packages/urllib3/util/connection.py\", line 61, in create_connection\n    for res in socket.getaddrinfo(host, port, family, socket.SOCK_STREAM):\n  File \"/usr/lib/python3.8/socket.py\", line 918, in getaddrinfo\n    for res in _socket.getaddrinfo(host, port, family, type, proto, flags):\nsocket.gaierror: [Errno -2] Name or service not known\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/httpsession.py\", line 464, in send\n    urllib_response = conn.urlopen(\n  File \"/usr/lib/python3/dist-packages/urllib3/connectionpool.py\", line 720, in urlopen\n    retries = retries.increment(\n  File \"/usr/lib/python3/dist-packages/urllib3/util/retry.py\", line 376, in increment\n    raise six.reraise(type(error), error, _stacktrace)\n  File \"/usr/lib/python3/dist-packages/six.py\", line 703, in reraise\n    raise value\n  File \"/usr/lib/python3/dist-packages/urllib3/connectionpool.py\", line 666, in urlopen\n    httplib_response = self._make_request(\n  File \"/usr/lib/python3/dist-packages/urllib3/connectionpool.py\", line 388, in _make_request\n    conn.request(method, url, **httplib_request_kw)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/awsrequest.py\", line 96, in request\n    rval = super().request(method, url, body, headers, *args, **kwargs)\n  File \"/usr/lib/python3.8/http/client.py\", line 1256, in request\n    self._send_request(method, url, body, headers, encode_chunked)\n  File \"/usr/lib/python3.8/http/client.py\", line 1302, in _send_request\n    self.endheaders(body, encode_chunked=encode_chunked)\n  File \"/usr/lib/python3.8/http/client.py\", line 1251, in endheaders\n    self._send_output(message_body, encode_chunked=encode_chunked)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/awsrequest.py\", line 123, in _send_output\n    self.send(msg)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/awsrequest.py\", line 223, in send\n    return super().send(str)\n  File \"/usr/lib/python3.8/http/client.py\", line 951, in send\n    self.connect()\n  File \"/usr/lib/python3/dist-packages/urllib3/connection.py\", line 187, in connect\n    conn = self._new_conn()\n  File \"/usr/lib/python3/dist-packages/urllib3/connection.py\", line 171, in _new_conn\n    raise NewConnectionError(\nurllib3.exceptions.NewConnectionError: <botocore.awsrequest.AWSHTTPConnection object at 0x7f4a843750d0>: Failed to establish a new connection: [Errno -2] Name or service not known\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/single-cell-data-portal/backend/layers/processing/upload_failures/app.py\", line 198, in cleanup_artifacts\n    delete_many_from_s3(cellxgene_bucket, object_key + \".cxg/\")\n  File \"/single-cell-data-portal/backend/common/utils/aws.py\", line 107, in delete_many_from_s3\n    bucket.objects.filter(Prefix=f\"{prefix}\").delete()\n  File \"/usr/local/lib/python3.8/dist-packages/boto3/resources/collection.py\", line 561, in batch_action\n    return action(self, *args, **kwargs)\n  File \"/usr/local/lib/python3.8/dist-packages/boto3/resources/action.py\", line 134, in __call__\n    for page in parent.pages():\n  File \"/usr/local/lib/python3.8/dist-packages/boto3/resources/collection.py\", line 171, in pages\n    for page in pages:\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/paginate.py\", line 269, in __iter__\n    response = self._make_request(current_kwargs)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/paginate.py\", line 357, in _make_request\n    return self._method(**current_kwargs)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/client.py\", line 565, in _api_call\n    return self._make_api_call(operation_name, kwargs)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/client.py\", line 1001, in _make_api_call\n    http, parsed_response = self._make_request(\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/client.py\", line 1027, in _make_request\n    return self._endpoint.make_request(operation_model, request_dict)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/endpoint.py\", line 119, in make_request\n    return self._send_request(request_dict, operation_model)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/endpoint.py\", line 202, in _send_request\n    while self._needs_retry(\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/endpoint.py\", line 354, in _needs_retry\n    responses = self._event_emitter.emit(\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/hooks.py\", line 412, in emit\n    return self._emitter.emit(aliased_event_name, **kwargs)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/hooks.py\", line 256, in emit\n    return self._emit(event_name, kwargs)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/hooks.py\", line 239, in _emit\n    response = handler(**kwargs)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/retryhandler.py\", line 207, in __call__\n    if self._checker(**checker_kwargs):\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/retryhandler.py\", line 284, in __call__\n    should_retry = self._should_retry(\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/retryhandler.py\", line 320, in _should_retry\n    return self._checker(attempt_number, response, caught_exception)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/retryhandler.py\", line 363, in __call__\n    checker_response = checker(\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/retryhandler.py\", line 247, in __call__\n    return self._check_caught_exception(\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/retryhandler.py\", line 416, in _check_caught_exception\n    raise caught_exception\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/endpoint.py\", line 281, in _do_get_response\n    http_response = self._send(request)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/endpoint.py\", line 377, in _send\n    return self.http_session.send(request)\n  File \"/usr/local/lib/python3.8/dist-packages/botocore/httpsession.py\", line 493, in send\n    raise EndpointConnectionError(endpoint_url=request.url, error=e)\nbotocore.exceptions.EndpointConnectionError: Could not connect to the endpoint URL: \"http://localstack:4566/cellxgene-bucket?prefix=123.cxg%2F&encoding-type=url\""}
