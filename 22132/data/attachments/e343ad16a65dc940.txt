{"levelname": "INFO", "asctime": "2024-10-01T05:23:13.001Z", "name": "root", "message": "", "lineno": 22, "pathname": "/single-cell-data-portal/backend/layers/processing/upload_failures/app.py", "dataset_version_id": "123", "collection_version_id": "456", "error": {}, "execution_id": "arn:aws:states:us-west-2:123456789012:execution:MyStateMachine"}
{"levelname": "ERROR", "asctime": "2024-10-01T05:23:16.001Z", "name": "processing", "message": "Failed to update dataset processing status", "lineno": 41, "pathname": "/single-cell-data-portal/backend/layers/processing/logger.py", "exc_info": "Traceback (most recent call last):\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/connection.py\", line 199, in _new_conn\n    sock = connection.create_connection(\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/util/connection.py\", line 60, in create_connection\n    for res in socket.getaddrinfo(host, port, family, socket.SOCK_STREAM):\n  File \"/usr/lib/python3.10/socket.py\", line 967, in getaddrinfo\n    for res in _socket.getaddrinfo(host, port, family, type, proto, flags):\nsocket.gaierror: [Errno -3] Temporary failure in name resolution\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/httpsession.py\", line 464, in send\n    urllib_response = conn.urlopen(\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/connectionpool.py\", line 843, in urlopen\n    retries = retries.increment(\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/util/retry.py\", line 449, in increment\n    raise reraise(type(error), error, _stacktrace)\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/util/util.py\", line 39, in reraise\n    raise value\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/connectionpool.py\", line 789, in urlopen\n    response = self._make_request(\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/connectionpool.py\", line 495, in _make_request\n    conn.request(\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/awsrequest.py\", line 96, in request\n    rval = super().request(method, url, body, headers, *args, **kwargs)\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/connection.py\", line 441, in request\n    self.endheaders()\n  File \"/usr/lib/python3.10/http/client.py\", line 1278, in endheaders\n    self._send_output(message_body, encode_chunked=encode_chunked)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/awsrequest.py\", line 123, in _send_output\n    self.send(msg)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/awsrequest.py\", line 223, in send\n    return super().send(str)\n  File \"/usr/lib/python3.10/http/client.py\", line 976, in send\n    self.connect()\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/connection.py\", line 279, in connect\n    self.sock = self._new_conn()\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/connection.py\", line 206, in _new_conn\n    raise NameResolutionError(self.host, self, e) from e\nurllib3.exceptions.NameResolutionError: <botocore.awsrequest.AWSHTTPConnection object at 0x7f6986959db0>: Failed to resolve 'localstack' ([Errno -3] Temporary failure in name resolution)\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/single-cell-data-portal/backend/layers/processing/upload_failures/app.py\", line 87, in update_dataset_processing_status_to_failed\n    get_business_logic().update_dataset_version_status(\n  File \"/single-cell-data-portal/backend/portal/api/providers.py\", line 18, in get_business_logic\n    DatabaseProvider(),\n  File \"/single-cell-data-portal/backend/layers/persistence/persistence.py\", line 57, in __init__\n    database_uri = CorporaDbConfig().database_uri\n  File \"/single-cell-data-portal/backend/common/utils/secret_config.py\", line 54, in __getattr__\n    self.load()\n  File \"/single-cell-data-portal/backend/common/utils/secret_config.py\", line 88, in load\n    self.load_from_aws()\n  File \"/single-cell-data-portal/backend/common/utils/secret_config.py\", line 99, in load_from_aws\n    secret = AwsSecret(secret_path)\n  File \"/single-cell-data-portal/backend/common/utils/aws.py\", line 31, in __init__\n    self._load()\n  File \"/single-cell-data-portal/backend/common/utils/aws.py\", line 76, in _load\n    response = self.secrets_mgr.describe_secret(SecretId=self.name)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/client.py\", line 569, in _api_call\n    return self._make_api_call(operation_name, kwargs)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/client.py\", line 1005, in _make_api_call\n    http, parsed_response = self._make_request(\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/client.py\", line 1029, in _make_request\n    return self._endpoint.make_request(operation_model, request_dict)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/endpoint.py\", line 119, in make_request\n    return self._send_request(request_dict, operation_model)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/endpoint.py\", line 200, in _send_request\n    while self._needs_retry(\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/endpoint.py\", line 360, in _needs_retry\n    responses = self._event_emitter.emit(\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/hooks.py\", line 412, in emit\n    return self._emitter.emit(aliased_event_name, **kwargs)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/hooks.py\", line 256, in emit\n    return self._emit(event_name, kwargs)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/hooks.py\", line 239, in _emit\n    response = handler(**kwargs)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/retryhandler.py\", line 207, in __call__\n    if self._checker(**checker_kwargs):\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/retryhandler.py\", line 284, in __call__\n    should_retry = self._should_retry(\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/retryhandler.py\", line 320, in _should_retry\n    return self._checker(attempt_number, response, caught_exception)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/retryhandler.py\", line 363, in __call__\n    checker_response = checker(\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/retryhandler.py\", line 247, in __call__\n    return self._check_caught_exception(\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/retryhandler.py\", line 416, in _check_caught_exception\n    raise caught_exception\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/endpoint.py\", line 279, in _do_get_response\n    http_response = self._send(request)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/endpoint.py\", line 383, in _send\n    return self.http_session.send(request)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/httpsession.py\", line 493, in send\n    raise EndpointConnectionError(endpoint_url=request.url, error=e)\nbotocore.exceptions.EndpointConnectionError: Could not connect to the endpoint URL: \"http://localstack:4566/\""}
{"levelname": "ERROR", "asctime": "2024-10-01T05:23:26.001Z", "name": "processing", "message": "Failed to clean up artifacts.", "lineno": 41, "pathname": "/single-cell-data-portal/backend/layers/processing/logger.py", "exc_info": "Traceback (most recent call last):\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/connection.py\", line 199, in _new_conn\n    sock = connection.create_connection(\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/util/connection.py\", line 60, in create_connection\n    for res in socket.getaddrinfo(host, port, family, socket.SOCK_STREAM):\n  File \"/usr/lib/python3.10/socket.py\", line 967, in getaddrinfo\n    for res in _socket.getaddrinfo(host, port, family, type, proto, flags):\nsocket.gaierror: [Errno -3] Temporary failure in name resolution\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/httpsession.py\", line 464, in send\n    urllib_response = conn.urlopen(\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/connectionpool.py\", line 843, in urlopen\n    retries = retries.increment(\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/util/retry.py\", line 449, in increment\n    raise reraise(type(error), error, _stacktrace)\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/util/util.py\", line 39, in reraise\n    raise value\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/connectionpool.py\", line 789, in urlopen\n    response = self._make_request(\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/connectionpool.py\", line 495, in _make_request\n    conn.request(\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/awsrequest.py\", line 96, in request\n    rval = super().request(method, url, body, headers, *args, **kwargs)\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/connection.py\", line 441, in request\n    self.endheaders()\n  File \"/usr/lib/python3.10/http/client.py\", line 1278, in endheaders\n    self._send_output(message_body, encode_chunked=encode_chunked)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/awsrequest.py\", line 123, in _send_output\n    self.send(msg)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/awsrequest.py\", line 223, in send\n    return super().send(str)\n  File \"/usr/lib/python3.10/http/client.py\", line 976, in send\n    self.connect()\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/connection.py\", line 279, in connect\n    self.sock = self._new_conn()\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/connection.py\", line 206, in _new_conn\n    raise NameResolutionError(self.host, self, e) from e\nurllib3.exceptions.NameResolutionError: <botocore.awsrequest.AWSHTTPConnection object at 0x7f6986a5b220>: Failed to resolve 'localstack' ([Errno -3] Temporary failure in name resolution)\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/single-cell-data-portal/backend/layers/processing/upload_failures/app.py\", line 192, in cleanup_artifacts\n    delete_many_from_s3(artifact_bucket, object_key + \"/\")\n  File \"/single-cell-data-portal/backend/common/utils/aws.py\", line 107, in delete_many_from_s3\n    bucket.objects.filter(Prefix=f\"{prefix}\").delete()\n  File \"/opt/venv/lib/python3.10/site-packages/boto3/resources/collection.py\", line 555, in batch_action\n    return action(self, *args, **kwargs)\n  File \"/opt/venv/lib/python3.10/site-packages/boto3/resources/action.py\", line 134, in __call__\n    for page in parent.pages():\n  File \"/opt/venv/lib/python3.10/site-packages/boto3/resources/collection.py\", line 169, in pages\n    for page in pages:\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/paginate.py\", line 269, in __iter__\n    response = self._make_request(current_kwargs)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/paginate.py\", line 357, in _make_request\n    return self._method(**current_kwargs)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/client.py\", line 569, in _api_call\n    return self._make_api_call(operation_name, kwargs)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/client.py\", line 1005, in _make_api_call\n    http, parsed_response = self._make_request(\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/client.py\", line 1029, in _make_request\n    return self._endpoint.make_request(operation_model, request_dict)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/endpoint.py\", line 119, in make_request\n    return self._send_request(request_dict, operation_model)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/endpoint.py\", line 200, in _send_request\n    while self._needs_retry(\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/endpoint.py\", line 360, in _needs_retry\n    responses = self._event_emitter.emit(\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/hooks.py\", line 412, in emit\n    return self._emitter.emit(aliased_event_name, **kwargs)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/hooks.py\", line 256, in emit\n    return self._emit(event_name, kwargs)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/hooks.py\", line 239, in _emit\n    response = handler(**kwargs)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/retryhandler.py\", line 207, in __call__\n    if self._checker(**checker_kwargs):\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/retryhandler.py\", line 284, in __call__\n    should_retry = self._should_retry(\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/retryhandler.py\", line 320, in _should_retry\n    return self._checker(attempt_number, response, caught_exception)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/retryhandler.py\", line 363, in __call__\n    checker_response = checker(\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/retryhandler.py\", line 247, in __call__\n    return self._check_caught_exception(\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/retryhandler.py\", line 416, in _check_caught_exception\n    raise caught_exception\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/endpoint.py\", line 279, in _do_get_response\n    http_response = self._send(request)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/endpoint.py\", line 383, in _send\n    return self.http_session.send(request)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/httpsession.py\", line 493, in send\n    raise EndpointConnectionError(endpoint_url=request.url, error=e)\nbotocore.exceptions.EndpointConnectionError: Could not connect to the endpoint URL: \"http://localstack:4566/artifact-bucket?prefix=123%2F&encoding-type=url\""}
{"levelname": "ERROR", "asctime": "2024-10-01T05:23:26.001Z", "name": "processing", "message": "Failed to clean up datasets.", "lineno": 41, "pathname": "/single-cell-data-portal/backend/layers/processing/logger.py", "exc_info": "Traceback (most recent call last):\n  File \"/single-cell-data-portal/backend/layers/processing/upload_failures/app.py\", line 194, in cleanup_artifacts\n    datasets_bucket = os.environ[\"DATASETS_BUCKET\"]\n  File \"/usr/lib/python3.10/os.py\", line 680, in __getitem__\n    raise KeyError(key) from None\nKeyError: 'DATASETS_BUCKET'"}
{"levelname": "ERROR", "asctime": "2024-10-01T05:23:30.001Z", "name": "processing", "message": "Failed to clean up cxgs.", "lineno": 41, "pathname": "/single-cell-data-portal/backend/layers/processing/logger.py", "exc_info": "Traceback (most recent call last):\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/connection.py\", line 199, in _new_conn\n    sock = connection.create_connection(\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/util/connection.py\", line 60, in create_connection\n    for res in socket.getaddrinfo(host, port, family, socket.SOCK_STREAM):\n  File \"/usr/lib/python3.10/socket.py\", line 967, in getaddrinfo\n    for res in _socket.getaddrinfo(host, port, family, type, proto, flags):\nsocket.gaierror: [Errno -3] Temporary failure in name resolution\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/httpsession.py\", line 464, in send\n    urllib_response = conn.urlopen(\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/connectionpool.py\", line 843, in urlopen\n    retries = retries.increment(\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/util/retry.py\", line 449, in increment\n    raise reraise(type(error), error, _stacktrace)\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/util/util.py\", line 39, in reraise\n    raise value\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/connectionpool.py\", line 789, in urlopen\n    response = self._make_request(\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/connectionpool.py\", line 495, in _make_request\n    conn.request(\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/awsrequest.py\", line 96, in request\n    rval = super().request(method, url, body, headers, *args, **kwargs)\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/connection.py\", line 441, in request\n    self.endheaders()\n  File \"/usr/lib/python3.10/http/client.py\", line 1278, in endheaders\n    self._send_output(message_body, encode_chunked=encode_chunked)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/awsrequest.py\", line 123, in _send_output\n    self.send(msg)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/awsrequest.py\", line 223, in send\n    return super().send(str)\n  File \"/usr/lib/python3.10/http/client.py\", line 976, in send\n    self.connect()\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/connection.py\", line 279, in connect\n    self.sock = self._new_conn()\n  File \"/opt/venv/lib/python3.10/site-packages/urllib3/connection.py\", line 206, in _new_conn\n    raise NameResolutionError(self.host, self, e) from e\nurllib3.exceptions.NameResolutionError: <botocore.awsrequest.AWSHTTPConnection object at 0x7f6984b80700>: Failed to resolve 'localstack' ([Errno -3] Temporary failure in name resolution)\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/single-cell-data-portal/backend/layers/processing/upload_failures/app.py\", line 198, in cleanup_artifacts\n    delete_many_from_s3(cellxgene_bucket, object_key + \".cxg/\")\n  File \"/single-cell-data-portal/backend/common/utils/aws.py\", line 107, in delete_many_from_s3\n    bucket.objects.filter(Prefix=f\"{prefix}\").delete()\n  File \"/opt/venv/lib/python3.10/site-packages/boto3/resources/collection.py\", line 555, in batch_action\n    return action(self, *args, **kwargs)\n  File \"/opt/venv/lib/python3.10/site-packages/boto3/resources/action.py\", line 134, in __call__\n    for page in parent.pages():\n  File \"/opt/venv/lib/python3.10/site-packages/boto3/resources/collection.py\", line 169, in pages\n    for page in pages:\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/paginate.py\", line 269, in __iter__\n    response = self._make_request(current_kwargs)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/paginate.py\", line 357, in _make_request\n    return self._method(**current_kwargs)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/client.py\", line 569, in _api_call\n    return self._make_api_call(operation_name, kwargs)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/client.py\", line 1005, in _make_api_call\n    http, parsed_response = self._make_request(\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/client.py\", line 1029, in _make_request\n    return self._endpoint.make_request(operation_model, request_dict)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/endpoint.py\", line 119, in make_request\n    return self._send_request(request_dict, operation_model)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/endpoint.py\", line 200, in _send_request\n    while self._needs_retry(\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/endpoint.py\", line 360, in _needs_retry\n    responses = self._event_emitter.emit(\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/hooks.py\", line 412, in emit\n    return self._emitter.emit(aliased_event_name, **kwargs)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/hooks.py\", line 256, in emit\n    return self._emit(event_name, kwargs)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/hooks.py\", line 239, in _emit\n    response = handler(**kwargs)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/retryhandler.py\", line 207, in __call__\n    if self._checker(**checker_kwargs):\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/retryhandler.py\", line 284, in __call__\n    should_retry = self._should_retry(\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/retryhandler.py\", line 320, in _should_retry\n    return self._checker(attempt_number, response, caught_exception)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/retryhandler.py\", line 363, in __call__\n    checker_response = checker(\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/retryhandler.py\", line 247, in __call__\n    return self._check_caught_exception(\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/retryhandler.py\", line 416, in _check_caught_exception\n    raise caught_exception\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/endpoint.py\", line 279, in _do_get_response\n    http_response = self._send(request)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/endpoint.py\", line 383, in _send\n    return self.http_session.send(request)\n  File \"/opt/venv/lib/python3.10/site-packages/botocore/httpsession.py\", line 493, in send\n    raise EndpointConnectionError(endpoint_url=request.url, error=e)\nbotocore.exceptions.EndpointConnectionError: Could not connect to the endpoint URL: \"http://localstack:4566/cellxgene-bucket?prefix=123.cxg%2F&encoding-type=url\""}
